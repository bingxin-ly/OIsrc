## **图论建模，用来处理 _点权或者点的流量限制_ 的问题**

我们把构造的图看成一层，将它复制，就有了很多层一模一样的图。这个时候，如果我们要对单点进行一些不可说明的操作，我们就将操作转化为一条边，沟通我们之前的很多层图。

分层图板子

```cpp
for (int i = 0, x, y, z; i < m; i++)
{
    cin >> x >> y >> z;
    x++, y++;
    add(x, y, z), add(y, x, z);
    for (int j = 1; j <= k; j++)
    {
        add(x + (j - 1) * n, y + j * n, 0);
        add(y + (j - 1) * n, x + j * n, 0);
        // j-1层 和 j层 间的建边
        add(x + j * n, y + j * n, z);
        add(y + j * n, x + j * n, z);
        // j层 的建边
    }
}

for (int i = 0; i <= k; i++)
    add(t + i * n, t + (i + 1) * n, 0);
// 防止毒瘤数据，k 次机会还没用完就到终点了
```

每进行一次操作（k+1），除了操作的边，其他边没有任何变化，在 k=0,1,2,…，时图都是一样的，那么就将图复制成 k+1 份，第 i 层图代表进行了 i 次操作后的图。

每相邻两层图之间的联系，应该决定了一次操作是发生在哪条边上（何时进行操作）。根据操作的特点（对边权的修改）可以 i 层点到 i+1 层点的边来表示一次操作。

![](https://img-blog.csdnimg.cn/20181217144012416.png)
那么对于分层图的构建步骤可以描述为：
1、先将图复制成 k+1 份 （0 ~ k）
2、对于图中的每一条边 <u,v> 从 ui 到 vi+1 建立与题目所给操作相对应的边（i=0,1,…,k）

k 代表了进行操作的次数，而每层之间点的关系代表了何时进行操作。
分层图示意图：  
![](https://img-blog.csdnimg.cn/20181217151240943.png)

例题：[[JLOI2011]飞行路线 - 洛谷](https://www.luogu.com.cn/problem/P4568)

各层内部正常连边，各层之间从上到下连权值为 0 的边。
每向下跑一层，就相当于免费搭一次飞机，最多有 k 条航线可以免费乘坐，故只需建 k+1 层分层图再从起点执行一遍最短路，再所有层的终点的值中取最小的即为最终答案  
![](https://img-blog.csdnimg.cn/6bde8ff1bb9842dfaeaad9c597379e65.png)

**复杂度注意：**
由于分层图的空间复杂度及时间复杂度较高（特别是空间复杂度），故在分析时一定要计算好时间及空间，空间为

$$边数m*（层数k+1）$$

无向图则需*2（可以理解为2个点互连的有向图）。千万不要因为空间没开够或爆空间而导致 RE！！！

### [实现代码](./4568flight_path.cpp)
